<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TIM :: Smart Life Services</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <!--link rel="icon" href="../../favicon.ico"-->

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <link href="css/general.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')</script>
    <script src="js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>
    <script src="js/general.js"></script>
</head>
<body>
<div id="divNavbar">
</div>
<div class="container">
    <!--Title and navigation info-->

    <!--Go back links -->
    <!--<div class="col-md-4 col-xs-12">
        <div class="side-link-wrapper pull-left">
            <p id="linkToCategory"></p>
            <a href="#"><p>< Promozioni</p></a>
            <a href="#"><p>< Device</p></a>
        </div>
    </div>-->
    <!--Main title and nav links -->
    <div class="row">
        <!--Previous link for small diveces-->
        <nav>
            <ul class="pager hidden-md hidden-lg">
                <li class="previous"><a href="#" class="backToSLCat"></a>
            </ul>
        </nav>
        <!--General navigation for big screens-->
        <nav>
            <ul class="pager">
                <li class="previous hidden-sm hidden-xs"><a href="#" class="backToSLCat"></a></li>
                <li class="previous toHide hidden-sm hidden-xs"><a href="#" class="backToPromoOrDevice"></a></li>
                <li class="hidden-sm hidden-xs"><a href="#" class="aPrevInCat toHide"></a></li>
                <li><h1 style="display: inline" id="dataNomeSL">SL Title</h1></li>
                <li class="hidden-sm hidden-xs"><a href="#" class="aNextInCat toHide">Successivo<span
                        aria-hidden="true">&rarr;</span></a></li>
            </ul>
        </nav>
        <!--Navigation for small and x-small devices -->
        <nav>
            <ul class="pager hidden-md hidden-lg">
                <li><a href="#" class="aPrevInCat toHide"><span aria-hidden="true">&larr;</span>Precedente</a></li>
                <li><a href="#" class="aNextInCat toHide">Successivo<span aria-hidden="true">&rarr;</span></a></li>
            </ul>
        </nav>
    </div>
    <!--				<div class="col-md-8 col-xs-12">
                        <div class="row">
                            <div class="col-xs-4">
                                <a href="#" id="aPrevInCat"><p class="text-right"><< Precedente</p></a>
                                <a href="#"><p class="text-right"><< Precedente in promo</p></a>
                            </div>
                            <div class="col-xs-4" style="width: auto">

                            </div>
                            <div class="col-xs-4">
                                <a href="#" id="aNextInCat"><p class="text-left">Successivo >></p></a>
                                <a href="#"><p class="text-left">Successivo in promo >></p></a>
                            </div>
                        </div>
                    </div>-->

    <!--SL internal navigation -->
    <div class="row">
        <div class="col-xs-12">
            <div class="sl-navigation">
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a data-toggle="tab" href="#tab-description">Descrizione</a>
                    </li>
                    <li role="presentation"><a data-toggle="tab" href="#tab-activ">Attivazione e regolamento</a></li>
                    <li role="presentation"><a data-toggle="tab" href="#tab-faq">FAQ</a></li>
                    <li role="presentation"><a data-toggle="tab" href="#tab-device">Dispositivi</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="tab-content">
        <div class="tab-pane active" id="tab-description">
            <div class="container-fluid">
                <!--Description row-->
                <div class="row" id="sl-des-row">
                    <div class="row main-des-row">
                        <div class="col-xs-12 col-md-4">
                            <img class="img-responsive" id="dataImg">
                        </div>
                        <div class="col-xs-12 col-md-8">
                            <p id="dataDescrizione"></p>
                        </div>
                    </div>
                    <!--Divider-->
                    <div class="row">
                        <div class="col-xs-12">
                            <hr>
                        </div>
                    </div>
                    <!--Additional content row-->
                    <div class="row">
                        <div class="col-xs-12">
                            <!--p>Additional content</p-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab-activ">
            <div class="container-fluid">
                <!--Activation e rules row-->
                <div class="row" id="sl-act-row">
                    <div class="col-xs-12">
                        <div id="dataAttivazioneRegolamento"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab-faq">
            <div class="container-fluid">
                <!--FAQ row-->
                <div class="row" id="dataFAQ">
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab-device">
            <div class="container-fluid">
                <!--Devices row-->
                <div class="row" id="sl-devices-row">
                    <div class="row">
                        <div class="col-xs-12">
                            <h3>Puoi usare questo servizio con:</h3>
                        </div>
                    </div>
                    <div class="row" id="dataAssDevices">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var promoYes = '&getpromo=1';
    var promoNo = '';
    var sid = getURLParameter('sid');
    var promo = (getURLParameter('promo') != null) ? promoYes : promoNo;

    function buildFAQ(question, answer) {
        return '<div class="panel panel-default"><div class="panel-heading">' + question + '</div><div class="panel-body">' + answer + '</div></div>';
    }

    function buildAssDevices(dev) {
        var promoClass = (dev['inPromo'] == 1 ? 'promotion-item' : '');
        return '<a href="product.html?pid=' + dev['idProdotto'] + '&fromsl=' + sid + '">' +
                '<div class="col-sm-6 col-md-4">' +
                '<div class="thumbnail ' + promoClass + '">' +
                '<img src="' + imgPathProduct + dev['image'] + '" alt="' + dev['nome'] + '">' +
                '<div class="caption">' +
                '<h3>' + dev['nome'] + '</h3><p class="prezzo">' + dev['prezzo'].toFixed(2) + '&euro;' + '</p>' +
                '<div><ul style="margin-top: 25px;">' +
                '<li style="font-size: 9px; margin: -10px -30px 0px -30px"><p>' + dev['spec1'] + '</p></li>' +
                '<li style="font-size: 9px; margin: -10px -30px 0px -30px"><p>' + dev['spec2'] + '</p></li>' +
                '<li style="font-size: 9px; margin: -10px -30px 0px -30px"><p>' + dev['spec3'] + '</p></li>' +
                '<li style="font-size: 9px; margin: -10px -30px 0px -30px"><p>' + dev['spec4'] + '</p></li>' +
                '</ul></div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</a>';
    }

    function loadSL(sid, promo) {

        $('.toHide').addClass('hidden');
        var getDeviceName = (getURLParameter('fromdevice') != null) ? '&getdevicename=' + getURLParameter('fromdevice') : '';

        // Get data from DB
        $.ajax({
            url: mySite + 'dojson.php?get=singlesl&sid=' + sid + promo + getDeviceName,
            method: 'GET',
            dataType: 'json'
        }).done(function (data) {
            console.log(data);

            $('#dataNomeSL').html(data['nome']);
            $('#dataDescrizione').html(data['descrizione']);
            $('#dataAttivazioneRegolamento').html(data['attivazioneRegolamento']);

            if (data['image'] != null)
                $('#dataImg').attr('src', imgPathSL + data['image']);
            else
                $('#dataImg').attr('src', imgPathSL + 'placeholder.png');

            $('#dataFAQ').empty();
            if (data['faq'].length > 0) {
                $.each(data['faq'], function (i, v) {
                    $('#dataFAQ').append(buildFAQ(v['domanda'], v['risposta']));
                });
            } else {
                $('#dataFAQ').html('Non sono disponibili domande frequenti.');
            }

            $('#dataAssDevices').empty();
            if (data['assDevices'].length > 0) {
                $.each(data['assDevices'], function (i, v) {
                    $('#dataAssDevices').append(buildAssDevices(v));
                });
            } else {
                $('#dataAssDevices').append('<p>Nessun prodotto associato a questo servizio.</p>');
            }

            //$('#linkToCategory').html('<a href="sl_by_category.html?catid=' + data['rifCategoria'] + '">< ' + data['categoria'] + '</a>')

            $('.backToSLCat').attr('href', 'sl_by_category.html?catid=' + data['rifCategoria']).html('<span aria-hidden="true">&larr;</span> ' + data['categoria']);

            if (promo) {
                $('.backToPromoOrDevice').attr('href', 'sl_by_category.html?catid=0').html('<span aria-hidden="true">&larr;</span> Promozioni').parent().removeClass('hidden');
            } else if (getURLParameter('fromdevice') != null && data['prevDeviceName'] != null) {
                // Back to Device link
                $('.backToPromoOrDevice').attr('href', 'product.html?pid=' + getURLParameter('fromdevice')).html('<span aria-hidden="true">&larr;</span> ' + data['prevDeviceName']).parent().removeClass('hidden');
            }

            if (data['promoPrev'] != undefined) {
                $('.aPrevInCat').unbind('click').click(function () {
                    loadSL(data['promoPrev'], promoYes)
                }).html('<span aria-hidden="true">&larr;</span>Precedente in promo').removeClass('hidden');
            } else if (data['prevInCat'] != undefined && !promo) {
                $('.aPrevInCat').unbind('click').click(function () {
                    loadSL(data['prevInCat'], promoNo)
                }).html('<span aria-hidden="true">&larr;</span>Precedente').removeClass('hidden');

            }

            if (data['promoNext'] != undefined) {
                $('.aNextInCat').unbind('click').click(function () {
                    loadSL(data['promoNext'], promoYes)
                }).html('Successivo in promo<span aria-hidden="true">&rarr;</span>').removeClass('hidden');
            } else if (data['nextInCat'] != undefined && !promo) {
                $('.aNextInCat').unbind('click').click(function () {
                    loadSL(data['nextInCat'], promoNo)
                }).html('Successivo<span aria-hidden="true">&rarr;</span>').removeClass('hidden');
            }


        }).fail(function () {
            ajaxErrorRep();
        });


        // return statement for links
        return false;
    }

    $(function () {
        loadSL(sid, promo);
    });

    function setActivePageCaller() {
        setActivePage('#liNavSL');
    }
</script>
<div id="divFooter">
</div>
</body>
</html>

